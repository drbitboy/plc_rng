<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!--Random Number Generator Subroutine-->
<RSLogix5000Content SchemaRevision="1.0" SoftwareRevision="28.01" TargetName="R010_RNG" TargetType="Routine" TargetSubType="RLL" ContainsContext="true" Owner="image, Microsoft" ExportDate="Fri Dec 27 07:39:13 2019" ExportOptions="References NoRawData L5KData DecoratedData Context Dependencies ForceProtectedEncoding AllProjDocTrans">
<Controller Use="Context" Name="RNG_AOI">
<DataTypes Use="Context">
</DataTypes>
<AddOnInstructionDefinitions Use="Context">
<AddOnInstructionDefinition Name="A_Uniform_RNG" Revision="1.0" ExecutePrescan="false" ExecutePostscan="false" ExecuteEnableInFalse="false" CreatedDate="2019-12-25T19:53:36.259Z" CreatedBy="DOMAIN1\carp" EditedDate="2019-12-25T23:30:26.292Z" EditedBy="DOMAIN1\carp" SoftwareRevision="v28.01">
<Description>
<![CDATA[Random Number Generator AOI
Uses Linear Congruential Generator (LCG)
1) Get Seed Number from either previous execution or default
2) Generate next Seed via LCG
4) Step #4 = Scale Seed to output range [Out_lo:out_hi)
]]>
</Description>
<Parameters>
<Parameter Name="EnableIn" TagType="Base" DataType="BOOL" Usage="Input" Radix="Decimal" Required="false" Visible="false" ExternalAccess="Read Only">
<Description>
<![CDATA[Enable Input - System Defined Parameter]]>
</Description>
</Parameter>
<Parameter Name="EnableOut" TagType="Base" DataType="BOOL" Usage="Output" Radix="Decimal" Required="false" Visible="false" ExternalAccess="Read Only">
<Description>
<![CDATA[Enable Output - System Defined Parameter]]>
</Description>
</Parameter>
<Parameter Name="Seed" TagType="Base" DataType="DINT" Usage="Input" Radix="Decimal" Required="true" Visible="true" ExternalAccess="Read/Write">
<Description>
<![CDATA[LCG input seed; updated after each execution]]>
</Description>
<DefaultData Format="L5K">
<![CDATA[0]]>
</DefaultData>
<DefaultData Format="Decorated">
<DataValue DataType="DINT" Radix="Decimal" Value="0"/>
</DefaultData>
</Parameter>
<Parameter Name="A" TagType="Base" DataType="DINT" Usage="Input" Radix="Decimal" Required="true" Visible="true" ExternalAccess="Read/Write">
<Description>
<![CDATA[LCG multiplicative parameter A
 in (Seed(n+1) = Seed(n) * A + C) MOD Modulus; default is from glibc implementation]]>
</Description>
<DefaultData Format="L5K">
<![CDATA[110351245]]>
</DefaultData>
<DefaultData Format="Decorated">
<DataValue DataType="DINT" Radix="Decimal" Value="110351245"/>
</DefaultData>
</Parameter>
<Parameter Name="B" TagType="Base" DataType="DINT" Usage="Input" Radix="Decimal" Required="true" Visible="true" ExternalAccess="Read/Write">
<Description>
<![CDATA[LCG additive parameter A
 in Seed(n+1) = (Seed(n) * A + C) MOD Modulus; default PJC/BTC/WA value]]>
</Description>
<DefaultData Format="L5K">
<![CDATA[12345]]>
</DefaultData>
<DefaultData Format="Decorated">
<DataValue DataType="DINT" Radix="Decimal" Value="12345"/>
</DefaultData>
</Parameter>
<Parameter Name="Mod_less_one" TagType="Base" DataType="DINT" Usage="Input" Radix="Decimal" Required="true" Visible="true" ExternalAccess="Read/Write">
<Description>
<![CDATA[LCG Modulus paramater, less one, in Seed(n+1) = (Seed(n) * A + C) Mod Modulus; DO NOT CHANGE THIS VALUE FROM ITS DEFAULT OF (2**31 - 1)]]>
</Description>
<DefaultData Format="L5K">
<![CDATA[2147483647]]>
</DefaultData>
<DefaultData Format="Decorated">
<DataValue DataType="DINT" Radix="Decimal" Value="2147483647"/>
</DefaultData>
</Parameter>
<Parameter Name="Out_lo" TagType="Base" DataType="REAL" Usage="Input" Radix="Float" Required="true" Visible="true" ExternalAccess="Read/Write">
<Description>
<![CDATA[Output value when updated seed is 0]]>
</Description>
<DefaultData Format="L5K">
<![CDATA[-1.00000000e+000]]>
</DefaultData>
<DefaultData Format="Decorated">
<DataValue DataType="REAL" Radix="Float" Value="-1.0"/>
</DefaultData>
</Parameter>
<Parameter Name="Out_hi" TagType="Base" DataType="REAL" Usage="Input" Radix="Float" Required="true" Visible="true" ExternalAccess="Read/Write">
<Description>
<![CDATA[Output value for an updated seed of 2**31 (theoretical)]]>
</Description>
<DefaultData Format="L5K">
<![CDATA[1.00000000e+000]]>
</DefaultData>
<DefaultData Format="Decorated">
<DataValue DataType="REAL" Radix="Float" Value="1.0"/>
</DefaultData>
</Parameter>
<Parameter Name="Output_scaled" TagType="Base" DataType="REAL" Usage="Output" Radix="Float" Required="true" Visible="true" ExternalAccess="Read Only">
<Description>
<![CDATA[Actual output value at each execution]]>
</Description>
<DefaultData Format="L5K">
<![CDATA[0.00000000e+000]]>
</DefaultData>
<DefaultData Format="Decorated">
<DataValue DataType="REAL" Radix="Float" Value="0.0"/>
</DefaultData>
</Parameter>
<Parameter Name="Seed_Ext" TagType="Base" DataType="DINT" Usage="Output" Radix="Decimal" Required="true" Visible="true" ExternalAccess="Read Only">
<DefaultData Format="L5K">
<![CDATA[0]]>
</DefaultData>
<DefaultData Format="Decorated">
<DataValue DataType="DINT" Radix="Decimal" Value="0"/>
</DefaultData>
</Parameter>
</Parameters>
<LocalTags>
<LocalTag Name="Se" DataType="DINT" Radix="Decimal" ExternalAccess="None">
<Description>
<![CDATA[Internal copy, and calculation, of seed]]>
</Description>
<DefaultData Format="L5K">
<![CDATA[0]]>
</DefaultData>
<DefaultData Format="Decorated">
<DataValue DataType="DINT" Radix="Decimal" Value="0"/>
</DefaultData>
</LocalTag>
<LocalTag Name="float_internal" DataType="REAL" Radix="Float" ExternalAccess="None">
<Description>
<![CDATA[Intermediate calculations for output scaling]]>
</Description>
<DefaultData Format="L5K">
<![CDATA[0.00000000e+000]]>
</DefaultData>
<DefaultData Format="Decorated">
<DataValue DataType="REAL" Radix="Float" Value="0.0"/>
</DefaultData>
</LocalTag>
</LocalTags>
<Routines>
<Routine Name="Logic" Type="RLL">
<RLLContent>
<Rung Number="0" Type="N">
<Comment>
<![CDATA[Random Number Generator using Linear Congruential Generator]]>
</Comment>
<Text>
<![CDATA[NOP();]]>
</Text>
</Rung>
<Rung Number="1" Type="N">
<Comment>
<![CDATA[This rung updates Seed:  Seed(n+1) = (Seed(n) * A + B) MOD (2**31)
N.B. MOD is implemented via DINT overflow plus bit-wise AND with (2**31 - 1) i.e. 0x7FFFFFFF.,
so local tag [Seed_internal] may not be the same as the final seed after the AND-cum-MOD
]]>
</Comment>
<Text>
<![CDATA[MUL(Seed,A,Se)ADD(Se,B,Se)AND(Se,Mod_less_one,Seed);]]>
</Text>
</Rung>
<Rung Number="2" Type="N">
<Comment>
<![CDATA[This rung scales Seed to Output_scaled:  Output_scaled(n+1) = Func(Seed(n+1),Out_lo,Out_hi)]]>
</Comment>
<Text>
<![CDATA[DIV(Output_scaled,2147483648.0,float_internal)CPT(Output_scaled,((1.0 - float_internal) * Out_lo) + (float_internal * Out_hi));]]>
</Text>
</Rung>
</RLLContent>
</Routine>
</Routines>
</AddOnInstructionDefinition>
</AddOnInstructionDefinitions>
<Tags Use="Context">
<Tag Name="BTC_RNG" TagType="Base" DataType="A_Uniform_RNG" Constant="false" ExternalAccess="Read/Write">
<Description>
<![CDATA[Linear Congruential Generator as a Random Number Generator]]>
</Description>
<Data Format="L5K">
<![CDATA[[1,0,110351245,12345,2147483647,0.00000000e+000,1.00000000e+000,0.00000000e+000,0,0,0.00000000e+000
					]]]>
</Data>
<Data Format="Decorated">
<Structure DataType="A_Uniform_RNG">
<DataValueMember Name="EnableIn" DataType="BOOL" Value="1"/>
<DataValueMember Name="EnableOut" DataType="BOOL" Value="0"/>
<DataValueMember Name="Seed" DataType="DINT" Radix="Decimal" Value="0"/>
<DataValueMember Name="A" DataType="DINT" Radix="Decimal" Value="110351245"/>
<DataValueMember Name="B" DataType="DINT" Radix="Decimal" Value="12345"/>
<DataValueMember Name="Mod_less_one" DataType="DINT" Radix="Decimal" Value="2147483647"/>
<DataValueMember Name="Out_lo" DataType="REAL" Radix="Float" Value="0.0"/>
<DataValueMember Name="Out_hi" DataType="REAL" Radix="Float" Value="1.0"/>
<DataValueMember Name="Output_scaled" DataType="REAL" Radix="Float" Value="0.0"/>
<DataValueMember Name="Seed_Ext" DataType="DINT" Radix="Decimal" Value="0"/>
</Structure>
</Data>
</Tag>
<Tag Name="Seed_External" TagType="Base" DataType="DINT" Radix="Decimal" Constant="false" ExternalAccess="Read/Write">
<Description>
<![CDATA[Random Number Generator Seed External / Output DINT]]>
</Description>
<Data Format="L5K">
<![CDATA[0]]>
</Data>
<Data Format="Decorated">
<DataValue DataType="DINT" Radix="Decimal" Value="0"/>
</Data>
</Tag>
</Tags>
<Programs Use="Context">
<Program Use="Context" Name="MainProgram">
<Routines Use="Context">
<Routine Use="Target" Name="R010_RNG" Type="RLL">
<Description>
<![CDATA[Random Number Generator Subroutine]]>
</Description>
<RLLContent>
<Rung Number="0" Type="N">
<Text>
<![CDATA[A_Uniform_RNG(BTC_RNG,BTC_RNG.Seed,BTC_RNG.A,BTC_RNG.B,BTC_RNG.Mod_less_one,BTC_RNG.Out_lo,BTC_RNG.Out_hi,BTC_RNG.Output_scaled,Seed_External);]]>
</Text>
</Rung>
</RLLContent>
</Routine>
</Routines>
</Program>
</Programs>
</Controller>
</RSLogix5000Content>
